<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Deep Web-Dev Comparator</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; }
        body { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .layout { display: flex; flex-direction: column; height: 100vh; gap: 20px; }
        .inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; flex: 1; min-height: 300px; }
        textarea { background: #020617; color: #94a3b8; border: 1px solid #334155; border-radius: 8px; padding: 15px; font-size: 12px; resize: none; }
        textarea:focus { outline: 2px solid var(--accent); color: #fff; }
        .btn-container { text-align: center; }
        button { background: var(--accent); color: #000; border: none; padding: 12px 30px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 16px; }
        button:hover { opacity: 0.9; transform: scale(1.02); }
        .results { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; flex: 2; overflow: hidden; padding-bottom: 20px; }
        .col { background: var(--card); border-radius: 8px; display: flex; flex-direction: column; border: 1px solid #334155; }
        .col h2 { font-size: 14px; padding: 10px; margin: 0; background: #334155; text-align: center; color: var(--accent); }
        .list { overflow-y: auto; padding: 10px; flex: 1; }
        .item { display: flex; align-items: center; justify-content: space-between; background: #0f172a; padding: 6px 10px; margin-bottom: 4px; border-radius: 4px; border-left: 3px solid transparent; font-size: 12px; }
        .item.tag { border-left-color: #f43f5e; }
        .item.attr { border-left-color: #38bdf8; }
        .item.css { border-left-color: #a855f7; }
        .type-label { font-size: 9px; opacity: 0.5; text-transform: uppercase; border: 1px solid currentColor; padding: 1px 4px; border-radius: 3px; }
    </style>
</head>
<body>

<div class="layout">
    <div class="inputs">
        <textarea id="box1" placeholder="Wklej tekst 1 (notatki/kod)..."></textarea>
        <textarea id="box2" placeholder="Wklej tekst 2 (dokumentacja/standard)..."></textarea>
    </div>

    <div class="btn-container">
        <button onclick="compare()">ANALIZUJ I PORÓWNAJ</button>
    </div>

    <div class="results">
        <div class="col">
            <h2>WSPÓLNE</h2>
            <div id="res-common" class="list"></div>
        </div>
        <div class="col">
            <h2>TYLKO W PIERWSZYM</h2>
            <div id="res-left" class="list"></div>
        </div>
        <div class="col">
            <h2>TYLKO W DRUGIM</h2>
            <div id="res-right" class="list"></div>
        </div>
    </div>
</div>

<script>
function extract(text) {
    const found = new Map();
    
    // 1. Wykrywanie TAGÓW: szukamy <nazwa> lub "znacznika nazwa"
    const tags = text.match(/<[a-zA-Z0-9-]+>|(?<=znacznika\s)[a-z0-9-]+/g) || [];
    tags.forEach(t => {
        let clean = t.replace(/[<>]/g, '').toLowerCase();
        found.set(clean, { display: `<${clean}>`, type: 'tag' });
    });

    // 2. Wykrywanie CSS At-rules: @media, @keyframes
    const atRules = text.match(/@[a-z-][a-z0-9-]*/g) || [];
    atRules.forEach(r => found.set(r.toLowerCase(), { display: r.toLowerCase(), type: 'css' }));

    // 3. Wykrywanie ATRYBUTÓW i WŁAŚCIWOŚCI (Słowa z myślnikami lub techniczne konteksty)
    // Szukamy słów które: mają myślnik (np. font-size), są przed dwukropkiem, 
    // lub są na liście atrybutów HTML (np. href, src, colspan)
    const techWords = text.match(/\b([a-z0-9]+-[a-z0-9-]+|[a-z]{3,})\b(?=[\s=:–—])/g) || [];
    
    // Lista słów do ignorowania (popularne polskie/angielskie słowa w opisach)
    const blacklist = new Set(['jest', 'oraz', 'tytuł', 'treść', 'strony', 'element', 'lista', 'grupa', 'opis', 'dane', 'wartość', 'this', 'that', 'with', 'from']);

    techWords.forEach(w => {
        let clean = w.toLowerCase();
        if (blacklist.has(clean)) return;
        if (found.has(clean)) return;

        // Klasyfikacja CSS vs Atrybut
        let type = (clean.includes('color') || clean.includes('margin') || clean.includes('padding') || clean.includes('border') || clean.includes('display')) ? 'css' : 'attr';
        found.set(clean, { display: clean, type: type });
    });

    return found;
}

function createEl(data) {
    const div = document.createElement('div');
    div.className = `item ${data.type}`;
    div.innerHTML = `<span>${data.display}</span><span class="type-label">${data.type}</span>`;
    return div;
}

function compare() {
    const map1 = extract(document.getElementById('box1').value);
    const map2 = extract(document.getElementById('box2').value);

    const keys1 = Array.from(map1.keys());
    const keys2 = Array.from(map2.keys());

    const commonKeys = keys1.filter(k => map2.has(k)).sort();
    const leftKeys = keys1.filter(k => !map2.has(k)).sort();
    const rightKeys = keys2.filter(k => !map1.has(k)).sort();

    const render = (id, keys, sourceMap) => {
        const target = document.getElementById(id);
        target.innerHTML = '';
        keys.forEach(k => target.appendChild(createEl(sourceMap.get(k))));
    };

    render('res-common', commonKeys, map1);
    render('res-left', leftKeys, map1);
    render('res-right', rightKeys, map2);
}
</script>

</body>
</html>
